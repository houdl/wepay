require 'sinatra/base'

class FakeWechat < Sinatra::Base
  helpers do
    def hash_to_xml(hash)
      xml = '<xml>'
      hash.each { |k, v| xml << "<#{k}>#{v}</#{k}>" }
      xml << '</xml>'
      xml
    end
  end

  post '/pay/unifiedorder' do
    content_type :txt
    status 200

    hash = {
        return_code: 'SUCCESS',
        return_msg: 'OK',
        appid: 'wx2421b1c4370ec43b',
        mch_id: '10000100',
        nonce_str: 'IITRi8Iabbblz1Jc',
        sign: '7921E432F65EB8ED0CE9755F0E86D72F',
        result_code: 'SUCCESS',
        prepay_id: 'wx201411101639507cbf6ffd8b0779950874',
        trade_type: 'JSAPI'
    }

    body hash_to_xml(hash)
  end

  post '/pay/orderquery' do
    content_type :txt
    status 200

    hash = {
        return_code: 'SUCCESS',
        return_msg: 'OK',
        appid: 'wx2421b1c4370ec43b',
        mch_id: '10000100',
        nonce_str: 'IITRi8Iabbblz1Jc',
        sign: '7921E432F65EB8ED0CE9755F0E86D72F',
        result_code: 'SUCCESS',
        prepay_id: 'wx201411101639507cbf6ffd8b0779950874',
        trade_type: 'JSAPI'
    }

    body hash_to_xml(hash)
  end

  post '/pay/closeorder' do
    content_type :txt
    status 200

    hash = {
        return_code: 'SUCCESS',
        return_msg: 'OK',
        appid: 'wx2421b1c4370ec43b',
        mch_id: '10000100',
        nonce_str: 'IITRi8Iabbblz1Jc',
        sign: '7921E432F65EB8ED0CE9755F0E86D72F',
        result_code: 'SUCCESS',
        prepay_id: 'wx201411101639507cbf6ffd8b0779950874',
        trade_type: 'JSAPI'
    }

    body hash_to_xml(hash)
  end

  post '/pay/downloadbill' do
    content_type :txt
    status 200
    body "交易时间,公众账号ID,商户号,子商户号,设备号,微信订单号,商户订单号,用户标识,交易类型,交易状态,付款银行,货币种类,总金额,企业红包金额,微信退款单号,商户退款单号,退款金额,企业红包退款金额,退款类型,退款状态,商品名称,商户数据包,手续费,费率
`2016-05-03 11:56:03,`wx29d28524d6eaf623,`1217875501,`0,`869027027748196,`4000372001201605035461980602,`c855e980f31001330a930242ac110002,`oVIehjqqTsDlh6NdJHRH3EWFu7Ls,`APP,`SUCCESS,`CCB_DEBIT,`CNY,`99.00,`0.00,`0,`0,`0,`0,`,`,`懂你英语标准版 30 天,`,`1.98000,`2.00%
`2016-05-03 12:43:56,`wx29d28524d6eaf623,`1217875501,`0,`e0ccbaec1a4edc402df1ffc3c442122a25d784fd,`4000432001201605035464264825,`89b0ecb0f31701330a820242ac110002,`oVIehjpdyFjNOUoI7GZj04UTENG8,`APP,`SUCCESS,`CFT,`CNY,`99.00,`0.00,`0,`0,`0,`0,`,`,`懂你英语标准版 30 天,`,`1.98000,`2.00%
`2016-05-03 20:17:08,`wx29d28524d6eaf623,`1217875501,`0,`860076034744168,`4000532001201605035478120785,`dc5ead50f356013368db0242ac110002,`oVIehjhoFm8zf9FerVQG-QoA_btY,`APP,`SUCCESS,`CMB_CREDIT,`CNY,`99.00,`0.00,`0,`0,`0,`0,`,`,`懂你英语标准版 30 天,`,`1.98000,`2.00%
`2016-05-03 06:12:05,`wx29d28524d6eaf623,`1217875501,`0,`863738022833561,`4001002001201605035455646709,`c93a4940f2e00133f8990242ac110002,`oVIehjjmn8Ip4_kq9aF3s1AMM-xE,`APP,`SUCCESS,`ABC_DEBIT,`CNY,`99.90,`0.00,`0,`0,`0,`0,`,`,`30天英语极速提升课程,`,`2.00000,`2.00%
`2016-05-03 15:57:08,`wx29d28524d6eaf623,`1217875501,`0,`865166029416883,`4001562001201605035471132086,`88b15c20f332013388b90242ac110002,`oVIehjr85fYR_IXeJ83SbZ9AegII,`APP,`SUCCESS,`CMB_CREDIT,`CNY,`99.00,`0.00,`0,`0,`0,`0,`,`,`懂你英语标准版 30 天,`,`1.98000,`2.00%
`2016-05-03 21:16:48,`wx29d28524d6eaf623,`1217875501,`0,`19991bc03c5ab0918f764f3273a9b387e898d8af,`4002132001201605035481114912,`2feedd20f35f01331fe20242ac110002,`oVIehjmxIVv_B7S1OL2VbpNF6fuk,`APP,`SUCCESS,`CFT,`CNY,`99.00,`0.00,`0,`0,`0,`0,`,`,`懂你英语标准版 30 天,`,`1.98000,`2.00%
`2016-05-03 17:23:41,`wx29d28524d6eaf623,`1217875501,`0,`A000005556774D,`4002152001201605035473144184,`97ad5690f33e013388bc0242ac110002,`oVIehjjY9KN8YyKbrErBFIHHnG6I,`APP,`SUCCESS,`CMB_CREDIT,`CNY,`99.00,`0.00,`0,`0,`0,`0,`,`,`懂你英语标准版 30 天,`,`1.98000,`2.00%
`2016-05-03 00:20:02,`wx29d28524d6eaf623,`1217875501,`0,`14efe3d535778e336180cc0e45e75cee20a7b4b5,`4002162001201605035454638548,`9d96fcd0f2af01330ae90242ac110002,`oVIehjlYR5sOEeOYA9fV4zNhno5E,`APP,`SUCCESS,`ABC_CREDIT,`CNY,`99.90,`0.00,`0,`0,`0,`0,`,`,`30天英语极速提升课程,`,`2.00000,`2.00%
`2016-05-03 08:46:04,`wx29d28524d6eaf623,`1217875501,`0,`7472bfe221c561539c5ca59e71d07ebfca00e59e,`4003842001201605035458558833,`526b6b60f2f6013301530242ac110002,`oVIehjkJK1j6R2SL4TLEr2yqwUf0,`APP,`SUCCESS,`CFT,`CNY,`99.00,`0.00,`0,`0,`0,`0,`,`,`懂你英语标准版 30 天,`,`1.98000,`2.00%
`2016-05-03 23:37:50,`wx29d28524d6eaf623,`1217875501,`0,`868964029643374,`4004112001201605035485079228,`df69e5d0f37201331fe30242ac110002,`oVIehjkpbVh7eg46pQo7Lao1HImo,`APP,`SUCCESS,`ICBC_CREDIT,`CNY,`99.90,`0.00,`0,`0,`0,`0,`,`,`30天英语极速提升课程,`,`2.00000,`2.00%
`2016-05-03 09:08:27,`wx29d28524d6eaf623,`1217875501,`0,`865712027180649,`4004662001201605035457449125,`6f2ee520f2f90133014f0242ac110002,`oVIehjqEfhW4RU8r8zWhUy3k4q_w,`APP,`SUCCESS,`CCB_DEBIT,`CNY,`99.00,`0.00,`0,`0,`0,`0,`,`,`懂你英语标准版 30 天,`,`1.98000,`2.00%
`2016-05-03 20:20:30,`wx29d28524d6eaf623,`1217875501,`0,`0443920f5e99dbaa65c205fba715d0354bc5940c,`4005842001201605035478181871,`55c28fd0f3570133d3060242ac110002,`oVIehjj0PEhc8DKJYReua6DaiyNA,`APP,`SUCCESS,`CFT,`CNY,`99.90,`0.00,`0,`0,`0,`0,`,`,`30天英语极速提升课程,`,`2.00000,`2.00%
`2016-05-03 20:20:37,`wx29d28524d6eaf623,`1217875501,`0,`d50ed35d71c234667ef894651750321b7a277bc2,`4005842001201605035479444427,`57d37670f3570133d30c0242ac110002,`oVIehjsAUwqw3adBAsePtIwEu5Nw,`APP,`SUCCESS,`CCB_DEBIT,`CNY,`99.00,`0.00,`0,`0,`0,`0,`,`,`懂你英语标准版 30 天,`,`1.98000,`2.00%
`2016-05-03 20:13:09,`wx29d28524d6eaf623,`1217875501,`0,`9bb35c40ae310605f76ef92aa4ca8bec2754d33c,`4005872001201605035478056149,`4e0a2a90f35601331ff10242ac110002,`oVIehjot-Hy6STHdVh13INImVHPg,`APP,`SUCCESS,`ICBC_DEBIT,`CNY,`99.00,`0.00,`0,`0,`0,`0,`,`,`懂你英语标准版 30 天,`,`1.98000,`2.00%
`2016-05-03 23:58:42,`wx29d28524d6eaf623,`1217875501,`0,`5ea0875af90189e63d9efbdde9ff248364d57677,`4006392001201605035485257780,`c3e90f40f37501331fe80242ac110002,`oVIehjnFcb5dzNBDyyMPuQY8BTv4,`APP,`SUCCESS,`CCB_CREDIT,`CNY,`99.90,`0.00,`0,`0,`0,`0,`,`,`30天英语极速提升课程,`,`2.00000,`2.00%
`2016-05-03 10:15:23,`wx29d28524d6eaf623,`1217875501,`0,`359850056095750,`4006412001201605035459572111,`c9dacca0f3020133014a0242ac110002,`oVIehjnffg_UYv77FKFHnoc32ifM,`APP,`SUCCESS,`CMBC_DEBIT,`CNY,`99.90,`0.00,`0,`0,`0,`0,`,`,`30天英语极速提升课程,`,`2.00000,`2.00%
`2016-05-03 09:19:58,`wx29d28524d6eaf623,`1217875501,`0,`867451029954572,`4007112001201605035457577878,`0df99890f2fb013301580242ac110002,`oVIehjqCqnJmW6uRS3zt9jOs9wAo,`APP,`SUCCESS,`CFT,`CNY,`99.90,`0.00,`0,`0,`0,`0,`,`,`30天英语极速提升课程,`,`2.00000,`2.00%
`2016-05-03 16:55:38,`wx29d28524d6eaf623,`1217875501,`0,`90043a6484080e9392c02acdd8236de26c89fa48,`4007132001201605035472707491,`b5a05210f33a01330ea60242ac110002,`oVIehjpI-WDw9OlxYIsv44eNhAAY,`APP,`SUCCESS,`CFT,`CNY,`99.90,`0.00,`0,`0,`0,`0,`,`,`30天英语极速提升课程,`,`2.00000,`2.00%
`2016-05-03 11:17:18,`wx29d28524d6eaf623,`1217875501,`0,`c347f71b63d815e79b675b4610e2e34e9f50fe45,`4007192001201605035462597166,`7080ac50f30b013313540242ac110002,`oVIehjj5NXq6hERBzH__gQKlRPTE,`APP,`SUCCESS,`GDB_CREDIT,`CNY,`99.00,`0.00,`0,`0,`0,`0,`,`,`懂你英语标准版 30 天,`,`1.98000,`2.00%
`2016-05-03 21:17:38,`wx29d28524d6eaf623,`1217875501,`0,`353232074443070,`4007682001201605035482404304,`4ebb21e0f35f013368dc0242ac110002,`oVIehjg0KqFi6c5T0RhezsQ_qCVk,`APP,`SUCCESS,`CFT,`CNY,`99.90,`0.00,`0,`0,`0,`0,`,`,`30天英语极速提升课程,`,`2.00000,`2.00%
`2016-05-03 17:31:17,`wx29d28524d6eaf623,`1217875501,`0,`866654028084397,`4007832001201605035473274082,`b2d49360f33f013388c00242ac110002,`oVIehjpe52H-HtH7tGrrq1uRmwcc,`APP,`SUCCESS,`CFT,`CNY,`99.90,`0.00,`0,`0,`0,`0,`,`,`30天英语极速提升课程,`,`2.00000,`2.00%
`2016-05-03 13:55:37,`wx29d28524d6eaf623,`1217875501,`0,`868299027384113,`4008132001201605035467425128,`90b8d100f32101332ebe0242ac110002,`oVIehjjKEitObhWQ_6kPUckRWH3M,`APP,`SUCCESS,`CFT,`CNY,`0.01,`0.00,`0,`0,`0,`0,`,`,`懂你英语标准版 30 天,`,`0.00000,`2.00%
`2016-05-03 22:03:14,`wx29d28524d6eaf623,`1217875501,`0,`2e83862e3de8332e37e757104591237d35411a02,`4008472001201605035481857952,`acbfa8e0f36501330ea70242ac110002,`oVIehjrCgAFYAh7HaN7-d-1jgCmU,`APP,`SUCCESS,`SPDB_CREDIT,`CNY,`99.90,`0.00,`0,`0,`0,`0,`,`,`30天英语极速提升课程,`,`2.00000,`2.00%
`2016-05-03 15:37:16,`wx29d28524d6eaf623,`1217875501,`0,`867451028430194,`4008672001201605035469558851,`bff01060f32f0133aa9e0242ac110002,`oVIehjpXx_jV7vm4EOgHLkwcEisY,`APP,`SUCCESS,`CFT,`CNY,`99.90,`0.00,`0,`0,`0,`0,`,`,`30天英语极速提升课程,`,`2.00000,`2.00%
`2016-05-03 13:12:03,`wx29d28524d6eaf623,`1217875501,`0,`94255500d16aefac6ae3c3978872ed7ab20d8b1a,`4008882001201605035465425522,`7877cd40f31b0133134c0242ac110002,`oVIehjhV2MNewNZdg1yEcgSvoMfs,`APP,`SUCCESS,`ICBC_CREDIT,`CNY,`99.00,`0.00,`0,`0,`0,`0,`,`,`懂你英语标准版 30 天,`,`1.98000,`2.00%
`2016-05-03 23:51:31,`wx29d28524d6eaf623,`1217875501,`0,`54454433e39f8ffa2d0f92114dd1a858820b919f,`4008882001201605035486432164,`c951ce10f37401331fe50242ac110002,`oVIehjpcGOFKNUrIoCCl6EqHQI_U,`APP,`SUCCESS,`CMB_DEBIT,`CNY,`99.90,`0.00,`0,`0,`0,`0,`,`,`30天英语极速提升课程,`,`2.00000,`2.00%
`2016-05-03 23:51:53,`wx29d28524d6eaf623,`1217875501,`0,`865863029398018,`4010032001201605035486439654,`db1349b0f3740133d3060242ac110002,`oVIehjgl5prGLKjgdH1RLpI-mM8Y,`APP,`SUCCESS,`CMB_DEBIT,`CNY,`99.90,`0.00,`0,`0,`0,`0,`,`,`30天英语极速提升课程,`,`2.00000,`2.00%
总交易单数,总交易额,总退款金额,总企业红包退款金额,手续费总金额
`27,`2586.61,`0.00,`0.00,`51.76000"
  end
end
